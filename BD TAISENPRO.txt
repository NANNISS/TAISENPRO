notas bd 
-- =============================================
-- PADEL MANAGER - INICIALIZACI√ìN DE BASE DE DATOS
-- =============================================
-- Script robusto para crear todas las tablas en orden correcto
-- y insertar datos iniciales sin conflictos de foreign keys

-- =============================================
-- LIMPIAR BASE DE DATOS (OPCIONAL - SOLO PARA DESARROLLO)
-- =============================================
-- Descomentar las siguientes l√≠neas si quieres limpiar completamente la BD
-- DROP TABLE IF EXISTS match_participants CASCADE;
-- DROP TABLE IF EXISTS rankings CASCADE;
-- DROP TABLE IF EXISTS matches CASCADE;
-- DROP TABLE IF EXISTS news CASCADE;
-- DROP TABLE IF EXISTS players CASCADE;
-- DROP TABLE IF EXISTS tournaments CASCADE;
-- DROP TABLE IF EXISTS countries CASCADE;
-- DROP TABLE IF EXISTS users CASCADE;
-- DROP TABLE IF EXISTS config CASCADE;

-- =============================================
-- CREAR TABLAS EN ORDEN CORRECTO
-- =============================================

-- 1. Tabla de usuarios (sin dependencias)
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. Tabla de pa√≠ses (sin dependencias)
CREATE TABLE IF NOT EXISTS countries (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(3) UNIQUE NOT NULL,
    flag_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 3. Tabla de jugadores (depende de countries)
CREATE TABLE IF NOT EXISTS players (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    country_id INTEGER REFERENCES countries(id),
    birth_date DATE,
    height INTEGER,
    weight INTEGER,
    playing_hand VARCHAR(10),
    ranking_points INTEGER DEFAULT 0,
    current_ranking INTEGER,
    profile_image VARCHAR(255),
    bio TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. Tabla de torneos (depende de countries)
CREATE TABLE IF NOT EXISTS tournaments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    location VARCHAR(255) NOT NULL,
    country_id INTEGER REFERENCES countries(id),
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    prize_money BIGINT NOT NULL,
    currency VARCHAR(10) DEFAULT 'PYG',
    category VARCHAR(50) NOT NULL,
    status VARCHAR(20) DEFAULT 'upcoming',
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 5. Tabla de equipos (depende de players)
CREATE TABLE IF NOT EXISTS teams (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 6. Tabla de jugadores de equipos (depende de teams y players)
CREATE TABLE IF NOT EXISTS team_players (
    id SERIAL PRIMARY KEY,
    team_id INTEGER REFERENCES teams(id) ON DELETE CASCADE,
    player_id INTEGER REFERENCES players(id) ON DELETE CASCADE,
    position INTEGER NOT NULL DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(team_id, player_id)
);

-- 7. Tabla de partidos (depende de tournaments, players y teams)
CREATE TABLE IF NOT EXISTS matches (
    id SERIAL PRIMARY KEY,
    tournament_id INTEGER REFERENCES tournaments(id),
    round VARCHAR(50) NOT NULL,
    court VARCHAR(50),
    scheduled_date TIMESTAMP,
    actual_start_date TIMESTAMP,
    actual_end_date TIMESTAMP,
    is_doubles BOOLEAN DEFAULT false,
    winner_id INTEGER REFERENCES players(id),
    team1_id INTEGER REFERENCES teams(id),
    team2_id INTEGER REFERENCES teams(id),
    match_date DATE,
    match_time TIME,
    score VARCHAR(50),
    duration_minutes INTEGER,
    status VARCHAR(20) DEFAULT 'scheduled',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 8. Tabla de participantes de partidos (depende de matches y players)
CREATE TABLE IF NOT EXISTS match_participants (
    id SERIAL PRIMARY KEY,
    match_id INTEGER REFERENCES matches(id) ON DELETE CASCADE,
    player_id INTEGER REFERENCES players(id),
    is_winner BOOLEAN DEFAULT false,
    seed INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 8.1. Tabla de participantes de equipos en partidos (para partidos de dobles)
CREATE TABLE IF NOT EXISTS match_team_participants (
    id SERIAL PRIMARY KEY,
    match_id INTEGER REFERENCES matches(id) ON DELETE CASCADE,
    team_id INTEGER REFERENCES teams(id),
    is_winner BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 9. Tabla de rankings (depende de players)
CREATE TABLE IF NOT EXISTS rankings (
    id SERIAL PRIMARY KEY,
    player_id INTEGER REFERENCES players(id),
    position INTEGER NOT NULL,
    points INTEGER NOT NULL,
    previous_position INTEGER,
    category VARCHAR(20) DEFAULT 'singles',
    ranking_date DATE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 10. Tabla de noticias (depende de users)
CREATE TABLE IF NOT EXISTS news (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    excerpt VARCHAR(500),
    author_id INTEGER REFERENCES users(id),
    featured_image VARCHAR(255),
    status VARCHAR(20) DEFAULT 'draft',
    published_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 11. Tabla de configuraci√≥n del sistema (sin dependencias)
CREATE TABLE IF NOT EXISTS config (
    id SERIAL PRIMARY KEY,
    key VARCHAR(100) UNIQUE NOT NULL,
    value TEXT NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- =============================================
-- INSERTAR DATOS INICIALES (SOLO SI LAS TABLAS EST√ÅN VAC√çAS)
-- =============================================

-- 1. Insertar pa√≠ses (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM countries LIMIT 1) THEN
INSERT INTO countries (name, code, flag_url) VALUES
        ('Paraguay', 'PRY', 'https://flagcdn.com/w40/py.png'),
('Argentina', 'ARG', 'https://flagcdn.com/w40/ar.png'),
('Brasil', 'BRA', 'https://flagcdn.com/w40/br.png'),
        ('Uruguay', 'URY', 'https://flagcdn.com/w40/uy.png'),
        ('Espa√±a', 'ESP', 'https://flagcdn.com/w40/es.png'),
('Francia', 'FRA', 'https://flagcdn.com/w40/fr.png'),
('Italia', 'ITA', 'https://flagcdn.com/w40/it.png');

        RAISE NOTICE '‚úÖ Pa√≠ses insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla countries ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 2. Insertar usuarios (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM users LIMIT 1) THEN
        -- Nota: Las contrase√±as est√°n hasheadas con bcrypt para 'admin123'
        INSERT INTO users (email, password_hash, first_name, last_name, role) VALUES
        ('admin@padel.com.py', '$2a$10$DtPTljT0DttonXUq.MK/3ONsmdtIe/P2u.r8Grjy6co7ok7eYOgum', 'Admin', 'Sistema', 'admin'),
        ('editor@padel.com.py', '$2a$10$DtPTljT0DttonXUq.MK/3ONsmdtIe/P2u.r8Grjy6co7ok7eYOgum', 'Editor', 'Noticias', 'editor');
        
        RAISE NOTICE '‚úÖ Usuarios insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla users ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 3. Insertar jugadores (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM players LIMIT 1) THEN
        INSERT INTO players (first_name, last_name, country_id, birth_date, height, weight, playing_hand, ranking_points, current_ranking, bio) VALUES
        ('Carlos', 'Gonz√°lez', (SELECT id FROM countries WHERE code = 'PRY'), '1995-03-15', 180, 75, 'right', 15000, 1, 'Jugador profesional de p√°del con m√°s de 10 a√±os de experiencia'),
        ('Diego', 'Mart√≠nez', (SELECT id FROM countries WHERE code = 'PRY'), '1997-08-22', 175, 70, 'left', 14500, 2, 'Especialista en dobles, conocido por su juego agresivo'),
        ('Roberto', 'Silva', (SELECT id FROM countries WHERE code = 'PRY'), '1991-12-10', 185, 80, 'right', 14000, 3, 'Veterano del p√°del paraguayo con m√∫ltiples t√≠tulos nacionales'),
        ('Miguel', 'Ben√≠tez', (SELECT id FROM countries WHERE code = 'PRY'), '1989-05-18', 178, 72, 'right', 13500, 4, 'Capit√°n del equipo nacional de p√°del'),
        ('Luis', 'Fern√°ndez', (SELECT id FROM countries WHERE code = 'PRY'), '1993-09-30', 182, 78, 'left', 13000, 5, 'Joven promesa del p√°del paraguayo'),
        ('Antonio', 'Rodr√≠guez', (SELECT id FROM countries WHERE code = 'PRY'), '1981-11-25', 177, 74, 'right', 12500, 6, 'Leyenda del p√°del paraguayo, mentor de nuevas generaciones'),
        ('Fernando', 'Castro', (SELECT id FROM countries WHERE code = 'PRY'), '1994-07-12', 183, 77, 'right', 12000, 7, 'Jugador vers√°til con excelente t√©cnica de volea'),
        ('Ricardo', 'Mendoza', (SELECT id FROM countries WHERE code = 'ARG'), '1996-01-25', 179, 73, 'left', 11500, 8, 'Argentino radicado en Paraguay, especialista en saque'),
        ('Gabriel', 'Herrera', (SELECT id FROM countries WHERE code = 'PRY'), '1992-04-08', 176, 71, 'right', 11000, 9, 'Conocido por su juego mental y estrategia'),
        ('Sebasti√°n', 'Vega', (SELECT id FROM countries WHERE code = 'BRA'), '1998-11-14', 181, 76, 'left', 10500, 10, 'Brasile√±o con gran potencial, futuro del p√°del'),
        ('Pablo', 'Morales', (SELECT id FROM countries WHERE code = 'PRY'), '1990-09-03', 177, 74, 'right', 10000, 11, 'Veterano con experiencia en torneos internacionales'),
        ('Andr√©s', 'Jim√©nez', (SELECT id FROM countries WHERE code = 'PRY'), '1995-06-20', 182, 78, 'left', 9500, 12, 'Jugador t√°ctico con gran visi√≥n de juego'),
        ('Mart√≠n', 'Santos', (SELECT id FROM countries WHERE code = 'URY'), '1993-02-17', 178, 72, 'right', 9000, 13, 'Uruguayo con estilo de juego agresivo'),
        ('Javier', 'Torres', (SELECT id FROM countries WHERE code = 'PRY'), '1997-12-05', 180, 75, 'right', 8500, 14, 'Joven talento con futuro prometedor'),
        ('Eduardo', 'Ram√≠rez', (SELECT id FROM countries WHERE code = 'PRY'), '1991-08-28', 175, 69, 'left', 8000, 15, 'Especialista en partidos de dobles'),
        ('Nicol√°s', 'Guzm√°n', (SELECT id FROM countries WHERE code = 'PRY'), '1999-03-15', 184, 79, 'right', 7500, 16, 'Promesa del p√°del paraguayo, muy joven pero con gran t√©cnica');
        
        RAISE NOTICE '‚úÖ Jugadores insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla players ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;


-- 4. Insertar torneos (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM tournaments LIMIT 1) THEN
        INSERT INTO tournaments (name, location, country_id, start_date, end_date, prize_money, currency, category, status, description) VALUES
        ('ATP Padel Tour Asunci√≥n', 'Asunci√≥n, Paraguay', (SELECT id FROM countries WHERE code = 'PRY'), '2025-10-15', '2025-10-22', 3500000000, 'PYG', 'ATP 1000', 'upcoming', 'El torneo m√°s importante del a√±o en Paraguay'),
        ('World Padel Tour Ciudad del Este', 'Ciudad del Este, Paraguay', (SELECT id FROM countries WHERE code = 'PRY'), '2025-09-20', '2025-09-27', 2100000000, 'PYG', 'ATP 500', 'ongoing', 'Torneo internacional en la triple frontera'),
        ('ATP Padel Tour Encarnaci√≥n', 'Encarnaci√≥n, Paraguay', (SELECT id FROM countries WHERE code = 'PRY'), '2025-08-10', '2025-08-17', 2800000000, 'PYG', 'ATP 1000', 'finished', 'Torneo hist√≥rico en la Perla del Sur'),
        ('World Padel Tour Luque', 'Luque, Paraguay', (SELECT id FROM countries WHERE code = 'PRY'), '2025-11-05', '2025-11-12', 2450000000, 'PYG', 'ATP 500', 'upcoming', 'Torneo en la ciudad de los deportes');
        
        RAISE NOTICE '‚úÖ Torneos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla tournaments ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 5. Insertar equipos de ejemplo (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM teams LIMIT 1) THEN
        INSERT INTO teams (name) VALUES
        ('Jaguarete'),
        ('Carpincho');
        
        RAISE NOTICE '‚úÖ Equipos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla teams ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 6. Insertar jugadores de equipos (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM team_players LIMIT 1) THEN
        INSERT INTO team_players (team_id, player_id, position) VALUES
        -- Equipo Jaguarete
        ((SELECT id FROM teams WHERE name = 'Jaguarete'), (SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'), 1),
        ((SELECT id FROM teams WHERE name = 'Jaguarete'), (SELECT id FROM players WHERE first_name = 'Diego' AND last_name = 'Mart√≠nez'), 2),
        -- Equipo Carpincho
        ((SELECT id FROM teams WHERE name = 'Carpincho'), (SELECT id FROM players WHERE first_name = 'Roberto' AND last_name = 'Silva'), 1),
        ((SELECT id FROM teams WHERE name = 'Carpincho'), (SELECT id FROM players WHERE first_name = 'Miguel' AND last_name = 'Ben√≠tez'), 2);
        
        RAISE NOTICE '‚úÖ Jugadores de equipos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla team_players ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 7. Insertar rankings de jugadores (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM rankings LIMIT 1) THEN
        INSERT INTO rankings (player_id, position, points, previous_position, category, ranking_date) VALUES
        ((SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'), 1, 15000, 1, 'singles', CURRENT_DATE),
        ((SELECT id FROM players WHERE first_name = 'Diego' AND last_name = 'Mart√≠nez'), 2, 14500, 2, 'singles', CURRENT_DATE),
        ((SELECT id FROM players WHERE first_name = 'Roberto' AND last_name = 'Silva'), 3, 14000, 3, 'singles', CURRENT_DATE),
        ((SELECT id FROM players WHERE first_name = 'Miguel' AND last_name = 'Ben√≠tez'), 4, 13500, 4, 'singles', CURRENT_DATE),
        ((SELECT id FROM players WHERE first_name = 'Luis' AND last_name = 'Fern√°ndez'), 5, 13000, 5, 'singles', CURRENT_DATE),
        ((SELECT id FROM players WHERE first_name = 'Antonio' AND last_name = 'Rodr√≠guez'), 6, 12500, 6, 'singles', CURRENT_DATE);
        
        RAISE NOTICE '‚úÖ Rankings insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla rankings ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 8. Insertar partidos de ejemplo (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM matches LIMIT 1) THEN
        INSERT INTO matches (tournament_id, round, court, scheduled_date, is_doubles, status, team1_id, team2_id) VALUES
        -- Partidos de singles
        ((SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este'), 'Final', 'Pista Central', '2025-09-26 18:00:00', false, 'completed', NULL, NULL),
        ((SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este'), 'Semifinal', 'Pista 1', '2025-09-26 20:30:00', false, 'live', NULL, NULL),
        ((SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este'), 'Cuartos de Final', 'Pista 2', '2025-09-27 16:00:00', false, 'scheduled', NULL, NULL),
        ((SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n'), 'Semifinal', 'Pista Central', '2025-08-15 19:00:00', false, 'completed', NULL, NULL),
        -- Partidos de dobles
        ((SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este'), 'Final Dobles', 'Pista Central', '2025-09-27 20:00:00', true, 'scheduled', 1, 2),
        ((SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n'), 'Semifinal Dobles', 'Pista 1', '2025-08-16 18:00:00', true, 'completed', 1, 2);
        
        RAISE NOTICE '‚úÖ Partidos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla matches ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 9. Insertar participantes de partidos (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM match_participants LIMIT 1) THEN
INSERT INTO match_participants (match_id, player_id, is_winner, seed) VALUES
        -- Final Ciudad del Este
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Final'), 
         (SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'), true, 1),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Final'), 
         (SELECT id FROM players WHERE first_name = 'Diego' AND last_name = 'Mart√≠nez'), false, 2),
        -- Semifinal Ciudad del Este
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Semifinal'), 
         (SELECT id FROM players WHERE first_name = 'Roberto' AND last_name = 'Silva'), false, 3),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Semifinal'), 
         (SELECT id FROM players WHERE first_name = 'Miguel' AND last_name = 'Ben√≠tez'), false, 4),
        -- Cuartos Ciudad del Este
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Cuartos de Final'), 
         (SELECT id FROM players WHERE first_name = 'Luis' AND last_name = 'Fern√°ndez'), false, 5),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Cuartos de Final'), 
         (SELECT id FROM players WHERE first_name = 'Antonio' AND last_name = 'Rodr√≠guez'), false, 6),
        -- Semifinal Encarnaci√≥n
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n') AND round = 'Semifinal'), 
         (SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'), true, 1),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n') AND round = 'Semifinal'), 
         (SELECT id FROM players WHERE first_name = 'Roberto' AND last_name = 'Silva'), false, 3);
        
        RAISE NOTICE '‚úÖ Participantes de partidos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla match_participants ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 9.1. Insertar participantes de equipos en partidos de dobles (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM match_team_participants LIMIT 1) THEN
        INSERT INTO match_team_participants (match_id, team_id, is_winner) VALUES
        -- Final Dobles Ciudad del Este
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Final Dobles'), 
         (SELECT id FROM teams WHERE name = 'Jaguarete'), false),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') AND round = 'Final Dobles'), 
         (SELECT id FROM teams WHERE name = 'Carpincho'), false),
        -- Semifinal Dobles Encarnaci√≥n
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n') AND round = 'Semifinal Dobles'), 
         (SELECT id FROM teams WHERE name = 'Jaguarete'), true),
        ((SELECT id FROM matches WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n') AND round = 'Semifinal Dobles'), 
         (SELECT id FROM teams WHERE name = 'Carpincho'), false);
        
        RAISE NOTICE '‚úÖ Participantes de equipos insertados exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla match_team_participants ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 10. Actualizar partidos con resultados
UPDATE matches SET 
    winner_id = (SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'),
    score = '6-4, 6-2',
    duration_minutes = 95,
    actual_start_date = '2025-09-26 18:05:00',
    actual_end_date = '2025-09-26 19:40:00'
WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') 
AND round = 'Final';

UPDATE matches SET 
    actual_start_date = '2025-09-26 20:35:00'
WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'World Padel Tour Ciudad del Este') 
AND round = 'Semifinal';

UPDATE matches SET 
    winner_id = (SELECT id FROM players WHERE first_name = 'Carlos' AND last_name = 'Gonz√°lez'),
    score = '6-3, 6-1',
    duration_minutes = 78,
    actual_start_date = '2025-08-15 19:05:00',
    actual_end_date = '2025-08-15 20:23:00'
WHERE tournament_id = (SELECT id FROM tournaments WHERE name = 'ATP Padel Tour Encarnaci√≥n') 
AND round = 'Semifinal';

-- 11. Insertar noticias (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM news LIMIT 1) THEN
        INSERT INTO news (title, content, author_id, status, published_at) VALUES
        ('Carlos Gonz√°lez lidera el ranking paraguayo', 'El jugador asunceno mantiene su posici√≥n n√∫mero 1 en el ranking nacional tras su victoria en el √∫ltimo torneo.', 
         (SELECT id FROM users WHERE email = 'admin@padel.com.py'), 'published', CURRENT_TIMESTAMP),
        ('Nuevo torneo ATP en Asunci√≥n', 'Se confirma la realizaci√≥n del ATP Padel Tour Asunci√≥n con un premio de ‚Ç≤ 3.500.000.000.', 
         (SELECT id FROM users WHERE email = 'admin@padel.com.py'), 'published', CURRENT_TIMESTAMP),
        ('Paraguay se prepara para el Mundial', 'La selecci√≥n nacional de p√°del inicia su preparaci√≥n para el pr√≥ximo campeonato mundial.', 
         (SELECT id FROM users WHERE email = 'admin@padel.com.py'), 'published', CURRENT_TIMESTAMP);
        
        RAISE NOTICE '‚úÖ Noticias insertadas exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla news ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- 12. Insertar configuraci√≥n del sistema (solo si la tabla est√° vac√≠a)
DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM config LIMIT 1) THEN
        INSERT INTO config (key, value, description) VALUES
        ('tournament_categories', 'ATP 1000,ATP 500,ATP 250,Challenger,Futures,Exhibition', 'Categor√≠as disponibles para torneos'),
        ('match_rounds', 'Primera Ronda,Segunda Ronda,Octavos de Final,Cuartos de Final,Semifinal,Final', 'Rondas disponibles para partidos'),
        ('courts', 'Pista Central,Pista 1,Pista 2,Pista 3,Pista 4,Pista 5', 'Canchas disponibles para partidos');
        
        RAISE NOTICE '‚úÖ Configuraci√≥n del sistema insertada exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Tabla config ya contiene datos, omitiendo inserci√≥n';
    END IF;
END $$;

-- =============================================
-- VERIFICACIONES FINALES
-- =============================================

-- Verificar que todas las tablas fueron creadas
DO $$
DECLARE
    table_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO table_count 
    FROM information_schema.tables 
    WHERE table_schema = 'public' 
    AND table_name IN ('users', 'countries', 'players', 'tournaments', 'matches', 'match_participants', 'rankings', 'news', 'teams', 'team_players', 'config');
    
    IF table_count = 11 THEN
        RAISE NOTICE '‚úÖ Todas las tablas fueron creadas exitosamente';
    ELSE
        RAISE NOTICE '‚ö†Ô∏è Solo % de 11 tablas fueron encontradas', table_count;
    END IF;
END $$;

-- Verificar datos insertados
DO $$
DECLARE
    country_count INTEGER;
    user_count INTEGER;
    player_count INTEGER;
    tournament_count INTEGER;
    match_count INTEGER;
    news_count INTEGER;
    config_count INTEGER;
BEGIN
    SELECT COUNT(*) INTO country_count FROM countries;
    SELECT COUNT(*) INTO user_count FROM users;
    SELECT COUNT(*) INTO player_count FROM players;
    SELECT COUNT(*) INTO tournament_count FROM tournaments;
    SELECT COUNT(*) INTO match_count FROM matches;
    SELECT COUNT(*) INTO news_count FROM news;
    SELECT COUNT(*) INTO config_count FROM config;
    
    RAISE NOTICE 'üìä Datos insertados:';
    RAISE NOTICE '   Pa√≠ses: %', country_count;
    RAISE NOTICE '   Usuarios: %', user_count;
    RAISE NOTICE '   Jugadores: %', player_count;
    RAISE NOTICE '   Torneos: %', tournament_count;
    RAISE NOTICE '   Partidos: %', match_count;
    RAISE NOTICE '   Noticias: %', news_count;
    RAISE NOTICE '   Configuraciones: %', config_count;
END $$;

-- =============================================
-- FIN DEL SCRIPT
-- =============================================
DO $$
BEGIN
    RAISE NOTICE 'üéæ Base de datos Padel Manager inicializada exitosamente!';
    RAISE NOTICE 'üë§ Usuario admin: admin@padel.com.py / admin123';
    RAISE NOTICE 'üë§ Usuario editor: editor@padel.com.py / admin123';
END $$;